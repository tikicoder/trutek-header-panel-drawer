<!--
Copyright (c) 2014 TruTek LLC Authors. All rights reserved.
This code may only be used under the BSD style license included in the project.
-->

<link rel="import" href="../core-header-panel/core-header-panel.html">
<link rel="import" href="../core-toolbar/core-toolbar.html">
<link rel="import" href="../core-dropdown/core-dropdown.html">
<link rel="import" href="../core-input/core-input.html">

<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../trutek-tri-drawer-panel/trutek-tri-drawer-panel.html">
<polymer-element name="trutek-header-panel-drawer" attributes="responsiveWidthStep1 responsiveWidthStep2 mode searchDropDownOptions showHeaderDropDown showHeaderSearch showHeaderFilter headerSearchPlaceHolder customSearchHandler">

<template>

  <style>
    
    :host {
      display: block;
    }
    [userlogin] {
		display:none;
	}
	
    [drawer] {
      background-color: #fff;
      box-shadow: 1px 0 1px rgba(0, 0, 0, 0.1);
    }
    
    [wrapper] {
      height: 100%;
      background-color: #000;
    }
	
	[main] {
      height: 100%;
      background-color: #eee;
    }
    
    core-toolbar {
      background-color: #304ffe;
      color: #fff;
    }
	
	#siteSearch{
		background-color:#ffffff;
		color:#000000;
		border-radius: 30px;
		margin-left:-8px;
	}
	
	#siteSearch::shadow core-icon{
	height:15px;
	width:15px;
	}
	
	#siteSearchNarrow{
		background-color:#ffffff;
		color:#000000;
		border-radius: 30px;
		display:none;
		transition: -webkit-transform ease-in-out 0.3s, margin-left ease-in-out 0.3s;
		transition: transform ease-in-out 0.3s, margin-left ease-in-out 0.3s;
		-webkit-transform: translate3d(-50%, 0, 0);
		transform: translate3d(-50%, 0, 0);
	}
	#siteSearchNarrow::shadow core-icon{
	height:15px;
	width:15px;
	}
	
	#menuFilterSearch{
		color:#ffffff;
		font-weight:bold;
		border-radius: 30px;
		margin-left:-7px;
	}
	
	#menuFilterSearch::shadow core-icon{
	height:15px;
	width:15px;
		margin-top: 2px;
	}
	
	#menuFilterSearch::shadow span{
		font-size: 0.4em;
		display: block;
		margin: -11px 0px 6px 0px;
		padding-left: 7px;
		padding-right: 7px;
		color:#ffffff;
		font-weight:bold;
	}
	
	#divContainerNarrowSearch {
		position:absolute;top:0px;left:0px;
		background-color:#304ffe;
		width:100%;
		font-size:1.3em;
		padding-left:10px;
		padding-top:0px;
		transition: -webkit-transform ease-in-out 0.3s, height ease-in-out 0.3s;
		transition: transform ease-in-out 0.3s, height ease-in-out 0.3s;
	}
	.divContainerNarrowSearchClosed{
		height:0px;
		overflow:hidden;		
	}
	.divContainerNarrowSearchOpen{
		height:40px;
	}
	
	#searchInput{
		background-color:#FFFFFF;
		font-size:.6em;
		padding-top:5px;
		padding-bottom:5px;
		padding-left:5px;
		border-top-left-radius: 30px;
		border-bottom-left-radius: 30px;
		width:200px;
		float:left;
	}
		
	#searchInputNarrow{
		background-color:#FFFFFF;
		font-size:.6em;
		padding-top:5px;
		padding-bottom:5px;
		padding-left:5px;
		border-top-left-radius: 30px;
		border-bottom-left-radius: 30px;
		width:200px;
		float:left;
	}
	
	 #searchInputCategory {
		background-color: #FFFFFF;
		color:#cccccc;
		font-size:.6em;
		min-height: 6px;
		margin-left: -6px;
		border-left: solid 1px #Cccccc;
		float:left;
    }
	#searchInputCategory::shadow div core-item {
    min-height: 5px !important;
}
	#searchInputCategoryNarrow {
		background-color: #FFFFFF;
		color:#cccccc;
		font-size:.6em;
		min-height: 6px;
		margin-left: -6px;
		border-left: solid 1px #Cccccc;
		float:left;
		border-top-right-radius: 30px;
		border-bottom-right-radius: 30px;
    }
	#searchInputCategoryNarrow::shadow div core-item {
    min-height: 5px !important;
}
	
	.searchInputCategoryItem.core-selected{
		min-height: 5px;
		padding-top:5px;
		padding-bottom:5px;
		padding-left:5px;
	}
	
	.searchInputCategoryItem:not(.core-selected){
		color:#CCCCCC;
		min-height: 5px;
		padding-top:5px;
		padding-bottom:5px;
	}
	.searchInputCategoryItem:not(.core-selected):hover{
		color:#333333;
		cursor:pointer;
	}
	
	#divFullSearch{
		white-space:nowrap;		
		transition: -webkit-transform ease-in-out 0.3s, width ease-in-out 0.3s;
		transition: transform ease-in-out 0.3s, width ease-in-out 0.3s;
	}
	
	div.divFullSearchClosed{
		width:0px;
		overflow:hidden;
	}
	#divFullSearch > div{
		width:335px;
	}
	
	div.divFullSearchOpening{
		width:335px;
		overflow:hidden;
	}
	div.divFullSearchOpen{
		width:335px;
	}
	
	.siteSearchHeaderSearch{
  -webkit-animation: siteSearchHeader-search 0.3s ease-out forwards;
  animation: siteSearchHeader-search 0.3s ease-out forwards;
}

	.siteSearchHeaderSearchArrow{
  -webkit-animation: siteSearchHeader-searcharrow 0.3s ease-out backwards;
  animation: siteSearchHeader-searcharrow 0.3s ease-out backwards;
}

@-webkit-keyframes siteSearchHeader-search {
  12% {
    -webkit-transform: rotate(45deg);
  }
  25% {
    -webkit-transform: rotate(90deg);
  }
  38% {
    -webkit-transform: rotate(135deg);
	
  }
  50% {
    -webkit-transform: rotate(180deg);
	
  }
  62% {
    -webkit-transform: rotate(225deg);
	
  }
  75% {
    -webkit-transform: rotate(270deg);
	
  }
  88% {
    -webkit-transform: rotate(315deg);
	
  }
  100% {
    -webkit-transform: rotate(360deg);
	
  }
}

@-webkit-keyframes siteSearchHeader-searcharrow {
  12% {
    -webkit-transform: rotate(45deg);
  }
  25% {
    -webkit-transform: rotate(90deg);
  }
  38% {
    -webkit-transform: rotate(135deg);
	
  }
  50% {
    -webkit-transform: rotate(180deg);
	
  }
  62% {
    -webkit-transform: rotate(225deg);
	
  }
  75% {
    -webkit-transform: rotate(270deg);
	
  }
  88% {
    -webkit-transform: rotate(315deg);
	
  }
  100% {
    -webkit-transform: rotate(360deg);
	
  }
}

@keyframes siteSearchHeader-search {
  12% {
    transform: rotate(45deg);
  }
  25% {
    transform: rotate(90deg);
  }
  38% {
    transform: rotate(135deg);
	
  }
  50% {
    transform: rotate(180deg);
	
  }
  62% {
    transform: rotate(225deg);
	
  }
  75% {
    transform: rotate(270deg);
	
  }
  88% {
    transform: rotate(315deg);
	
  }
  100% {
    transform: rotate(360deg);
	
  }
}

@keyframes siteSearchHeader-searcharrow {
  12% {
    transform: rotate(45deg);
  }
  25% {
    transform: rotate(90deg);
  }
  38% {
    transform: rotate(135deg);
	
  }
  50% {
    transform: rotate(180deg);
	
  }
  62% {
    transform: rotate(225deg);
	
  }
  75% {
    transform: rotate(270deg);
	
  }
  88% {
    transform: rotate(315deg);
	
  }
  100% {
    transform: rotate(360deg);
	
  }
}



.siteSearchHeaderFilterSearch{
  -webkit-animation: siteSearchHeader-search 0.3s ease-out forwards;
  animation: siteSearchHeader-search 0.3s ease-out forwards;
}

	.siteSearchHeaderFilterSearchArrow{
  -webkit-animation: siteSearchHeaderFilterSearch-searcharrow 0.3s ease-out backwards;
  animation: siteSearchHeaderFilterSearch-searcharrow 0.3s ease-out backwards;
}

@-webkit-keyframes siteSearchHeaderFilterSearch-search {
  12% {
    -webkit-transform: rotate(45deg);
  }
  25% {
    -webkit-transform: rotate(90deg);
  }
  38% {
    -webkit-transform: rotate(135deg);
	
  }
  50% {
    -webkit-transform: rotate(180deg);
	
  }
  62% {
    -webkit-transform: rotate(225deg);
	
  }
  75% {
    -webkit-transform: rotate(270deg);
	
  }
  88% {
    -webkit-transform: rotate(315deg);
	
  }
  100% {
    -webkit-transform: rotate(360deg);
	
  }
}

@-webkit-keyframes siteSearchHeaderFilterSearch-searcharrow {
  12% {
    -webkit-transform: rotate(45deg);
  }
  25% {
    -webkit-transform: rotate(90deg);
  }
  38% {
    -webkit-transform: rotate(135deg);
	
  }
  50% {
    -webkit-transform: rotate(180deg);
	
  }
  62% {
    -webkit-transform: rotate(225deg);
	
  }
  75% {
    -webkit-transform: rotate(270deg);
	
  }
  88% {
    -webkit-transform: rotate(315deg);
	
  }
  100% {
    -webkit-transform: rotate(360deg);
	
  }
}

@keyframes siteSearchHeaderFilterSearch-search {
  12% {
    transform: rotate(45deg);
  }
  25% {
    transform: rotate(90deg);
  }
  38% {
    transform: rotate(135deg);
	
  }
  50% {
    transform: rotate(180deg);
	
  }
  62% {
    transform: rotate(225deg);
	
  }
  75% {
    transform: rotate(270deg);
	
  }
  88% {
    transform: rotate(315deg);
	
  }
  100% {
    transform: rotate(360deg);
	
  }
}

@keyframes siteSearchHeaderFilterSearch-searcharrow {
  12% {
    transform: rotate(45deg);
  }
  25% {
    transform: rotate(90deg);
  }
  38% {
    transform: rotate(135deg);
	
  }
  50% {
    transform: rotate(180deg);
	
  }
  62% {
    transform: rotate(225deg);
	
  }
  75% {
    transform: rotate(270deg);
	
  }
  88% {
    transform: rotate(315deg);
	
  }
  100% {
    transform: rotate(360deg);
	
  }
}

	#headerUserInfo{
	margin-left:auto;margin-right:10px;
	}
	
	#divAdvanceSearchFilter {
		height:100%;width:256px;position:absolute;background-color:#ffffff;top:0px;
		transition: -webkit-transform ease-in-out 0.3s, left ease-in-out 5s;
		transition: transform ease-in-out 0.3s, left ease-in-out 5s;
		z-index:10;
	}
	div.divAdvanceSearchFilterClosed{
		-webkit-transform: translate3d(-100%, 0, 0);
		transform: translate3d(-100%, 0, 0);
	}
  </style>
  
  <core-media-query query="max-width: {{responsiveWidthStep2 }}" queryMatches="{{queryMatchesStep2}}"></core-media-query>

   <core-header-panel wrapper mode="{{mode}}">
		<core-toolbar>
			<content select="[tool]"></content>
			<paper-icon-button id="menuButton" icon="menu" on-tap="{{togglePanel}}"></paper-icon-button>
			<template if="{{showHeaderSearch}}">
			<paper-icon-button id="siteSearchHeader" data-state="closed" icon="search" on-tap="{{toggleSearchPanel}}"  on-animationend="{{siteSearchHeaderAnimationEnd}}" on-webkitAnimationEnd="{{siteSearchHeaderAnimationEnd}}"></paper-icon-button>
			<div id="divFullSearch" class="divFullSearchClosed">
			<div>
				<div style="float:left;padding-top:5px;"><core-input id="searchInput" placeholder="{{headerSearchPlaceHolder}}" type="search"></core-input>
					<core-dropdown id="searchInputCategory" selected="Clothing" valueattr="label">
					<core-item label="Clothing" class="searchInputCategoryItem"></core-item>
					<core-item label="Outdoors" class="searchInputCategoryItem"></core-item>
					<core-item label="Sports" class="searchInputCategoryItem"></core-item>
				</core-dropdown>
				</div>
				<paper-icon-button id="siteSearch" icon="search" on-tap="{{processHeaderSearch}}" ></paper-icon-button>
				</div>
			</div>
			</template>
			<template if="{{showHeaderFilter}}">
				<paper-icon-button id="siteSearchNarrow" data-toggle="off" icon="search" on-tap="{{processHeaderSearch}}" ></paper-icon-button>
				<paper-icon-button id="menuFilterSearch" icon="filter" data-state="closed" on-animationend="{{siteSearchHeaderFilterSearchAnimationEnd}}"  on-webkitAnimationEnd="{{siteSearchHeaderFilterSearchAnimationEnd}}" on-tap="{{menuFilterSearchToggle}}" label="Filter"></paper-icon-button>
			</template>
			<div id="headerUserInfo">
			<content select="[userlogin]"></content>
			</div>
		</core-toolbar>
      <div id="divAdvanceSearchFilter" class="divAdvanceSearchFilterClosed">
		<content select="[searchAdvance]"></content>
		</div>
		<trutek-tri-drawer-panel id="drawerPanel" narrow="{{narrow}}"  responsiveWidth="{{responsiveWidth}}"  responsiveWidthStep1="{{responsiveWidthStep1}}"  responsiveWidthStep2="{{responsiveWidthStep2}}">

			<div vertical layout drawer>

			<content select="[navigation], nav"></content>

			</div>
			<div main>
			<div id="divContainerNarrowSearch" class="divContainerNarrowSearchClosed">
			<div style="float:left;padding-top:5px;"><core-input id="searchInputNarrow" placeholder="{{headerSearchPlaceHolder}}" type="search"></core-input>
					<core-dropdown id="searchInputCategoryNarrow" selected="Clothing" valueattr="label">
					<core-item label="Clothing" class="searchInputCategoryItem"></core-item>
					<core-item label="Outdoors" class="searchInputCategoryItem"></core-item>
					<core-item label="Sports" class="searchInputCategoryItem"></core-item>
				</core-dropdown>
				</div>
			</div>
				<content select="*"></content>
			</div>
		</trutek-tri-drawer-panel>
		
		
    </core-header-panel>
	


</template>
<script>

  Polymer('trutek-header-panel-drawer', {
    /**
     * When the browser window size is smaller than the `responsiveWidth`, 
     * `core-drawer-panel` changes to a narrow layout. In narrow layout, 
     * the drawer will be stacked on top of the main panel.
     *
     * @attribute responsiveWidth
     * @type string
     */    
	responsiveWidthStep1:'1050px',
	responsiveWidthStep2:'650px',
	searchDropDownOptions:[],
	showHeaderSearchDropDown:true,
	showHeaderSearch:true,
	showHeaderFilter:true,
	headerSearchPlaceHolder:"Search...",
	headerPanelNarrow: {value: false, reflect: true},
	customSearchHandler:null,

    /**
     * Used to control the header and scrolling behaviour of `core-header-panel`
     *
     * @attribute mode
     * @type string
     */     
    mode: 'seamed',

    /**
      * Toggle the drawer panel
      * @method togglePanel
      */    
    togglePanel: function() {
      this.$.drawerPanel.togglePanel();
    },

    /**
      * Open the drawer panel
      * @method openDrawer
      */      
    openDrawer: function() {
      this.$.drawerPanel.openDrawer();
    },

    /**
      * Close the drawer panel
      * @method closeDrawer
      */     
    closeDrawer: function() {
      this.$.drawerPanel.closeDrawer();
    },
	processHeaderSearch:function(){
	this.customSearchHandler();
	},
	domReady: function() {
      // to avoid transition at the beginning e.g. page loads
      // NOTE: domReady is already raf delayed and delaying another frame
      // ensures a layout has occurred.
      this.async(function() {
        this.transition = true;
      });
	  
    },
	
	toggleSearchPanel: function() {
	
      if(!this.headerPanelNarrow){
		if(this.$.siteSearchHeader.dataset.state!="open"){
			this.$.divFullSearch.className="divFullSearchOpening";
			this.$.siteSearchHeader.dataset.state="open";	
			this.$.siteSearchHeader.className="siteSearchHeaderSearch";
		  }
		  else{
			this.$.divFullSearch.className="divFullSearchClosed";
			this.$.siteSearchHeader.dataset.state="closed";
			this.$.siteSearchHeader.className="siteSearchHeaderSearchArrow";
		  }
	  }
	  else{
		if(this.$.siteSearchHeader.dataset.state!="open"){
			this.$.siteSearchHeader.dataset.state="open";
			this.$.siteSearchHeader.className="siteSearchHeaderSearch";
			this.$.divContainerNarrowSearch.className="divContainerNarrowSearchOpen";
			this.$.siteSearchNarrow.style.display="block";
			this.$.siteSearchNarrow.style.marginLeft="0px";
		}
		else{
			this.$.siteSearchHeader.dataset.state="closed";
			this.$.siteSearchHeader.className="siteSearchHeaderSearchArrow";
			this.$.divContainerNarrowSearch.className="divContainerNarrowSearchClosed";
			this.$.siteSearchNarrow.style.marginLeft="-45px";
			
		}
	  }
	  
	  this.fire('change');
	  	  
    },
	
    queryMatchesStep2Changed: function() {

		if(this.$.siteSearchHeader.dataset.state!="closed"){
			this.toggleSearchPanel();
		}
		
		this.headerPanelNarrow=this.queryMatchesStep2;
		
		if(this.headerPanelNarrow)
			this.$.headerUserInfo.style.display="none";
		else
			this.$.headerUserInfo.style.display="block";

	  
    },
	siteSearchHeaderAnimationEnd:function(){
		this.$.siteSearchHeader.className="";
		if(this.$.siteSearchHeader.dataset.state=="open"){
			this.$.siteSearchHeader.icon="arrow-back";
			if(!this.headerPanelNarrow){
				this.$.divFullSearch.className="divFullSearchOpen";
			}
		}
		else{
			this.$.siteSearchHeader.icon="search";
			this.$.siteSearchNarrow.style.display="none";
		}

	},
	siteSearchHeaderFilterSearchAnimationEnd:function(){
		this.$.menuFilterSearch.className="";
		if(this.$.menuFilterSearch.dataset.state=="open"){
			this.$.menuFilterSearch.icon="arrow-back";
		}
		else{
			this.$.menuFilterSearch.icon="filter";
		}

	},
	menuFilterSearchToggle: function() {
	
     if(this.$.menuFilterSearch.dataset.state!="open"){
			this.$.divAdvanceSearchFilter.className="";
			this.$.menuFilterSearch.dataset.state="open";
			this.$.menuFilterSearch.className="siteSearchHeaderFilterSearch";
		  }
		  else{
			this.$.divAdvanceSearchFilter.className="divAdvanceSearchFilterClosed";
			this.$.menuFilterSearch.dataset.state="closed";
			this.$.menuFilterSearch.className="siteSearchHeaderFilterSearchArrow";
		  }
	}
    
  });

</script>
</polymer-element>
